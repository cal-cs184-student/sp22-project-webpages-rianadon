<title>Assignment 4  |  CS 184</title>
<meta http-equiv="content-type" content="text/html; charset=utf-8" />
<link rel="stylesheet" type="text/css" href="style.css" media="screen" />
</head>
<body>
    <a href="https://cal-cs184-student.github.io/sp22-project-webpages-sweater/proj3-2/index.html">https://cal-cs184-student.github.io/sp22-project-webpages-sweater/proj4/index.html</a>
<br />
<h1 align="middle">Assignment 4: Cloth Simulation</h1>
    <h2 align="middle">Ryan Adolf & Natalie Kemper</h2>

    <div class="padded">
        <p>We coded a cloth simulation for this project, using physical concepts like masses and springs to model the cloth. Cloth sims are used for creating clothes and fabrics in animation, which is important for creating realistic motion and saving animators time. To implement our cloth simulation we coded the physics equations for our grid of points and handled cloth collisions with spheres, planes, and the cloth itself. For the final part of the project, we created shaders to shade the cloth with diffuse and Blinn-Phong shading as well as textures, bump maps, displacement maps, and environment-mapped reflections.</p>


        <h2 align="middle">Part 1: Masses and springs</h2>
					<p> In this part of the project, we created a cloth wireframe by construcing a grid of masses and springs. We added every point mass to a 1D <code>point_mass</code> vector,
					and different kinds of springs to a 1D <code>spring_mass</code> vector. </p>

					<p> We started constructing a grid of evenly space point masses first. To do this, we used a double for loop to iterate through the total number of
						height and width point masses, and checked the cloth's orientation to determine how to set each point masses' coordinates. If the cloth was oriented horizontally,
					  we set the y-coordinate of the point mass to 1.0, and varied positions over the xz plane. If the cloth was oriented vertically, we generated a small random offset for the
					  z-coordinate and varied positions over the xy plane. We stored each point mass in the <code>point_masses</code> vector in row-major-x-axis order. </p>

					<p> After creating the grid of masses, we began implement the grid of springs. Similarly, we created a double for loop to iterate through the total number of
					  height and width springs. For each of our point masses found in the <code>point_masses</code> vector, we created springs to apply the structual, shear, and bending constraints between point masses.
					  Each spring takes in pointers to the two point masses that belong at the two ends of the spring, and is added to the 1D <code>spring_masses</code> vector. We created springs of each type for all spring mass based on the rules of each constraint: </p>

					<p> 1.) Structural: Constraints exist between a point mass and the point mass to its left as well as the point mass above it</p>
					<p> 2.) Shearing: Constraints exist between a point mass and the point mass to its diagonal upper left as well as the point mass to its diagonal upper right</p>
					<p> 3.) Bending: Bending constraints exist between a point mass and the point mass two away to its left as well as the point mass two above it </p>

					<p> After filling the <code>point_masses</code> and <code>spring_masses</code> vectors with our point masses and springs, we were able to construct a wireframe of our cloth as shown below! </p>

					<div align="center">
						<table style="border-collapse: collapse">
								<tr>
									<td class="loops"><img src="part1/all.png" width="600px" align="middle" /></td>
									<td class="loops"><img src="part1/closeup.png" width="600px" align="middle" /></td>
								</tr>
						</table>
						<figcaption align="middle">Grid of spring and masses with structural, shearing, and bending constraints.</figcaption>
				</div>

				<div align="center">
						<table style="width=100%">
								<tr>
										<td>
												<img src="part1/structural1.png" align="middle" width="600px" />
												<figcaption align="middle">Wireframe with only structural and bending constraints</figcaption>
										</td>
										<td>
												<img src="part1/shearing1.png" align="middle" width="600px" />
												<figcaption align="middle">Wireframe with only shearing constraints</figcaption>
										</td>
								</tr>
						</table>
				</div>


        <h2 align="middle">Part 2: Simulation via numerical integration</h2>

        <p>The parameter <code>ks</code> controls the stiffness of the cloth. The cloth is most stiff (does not sag and looks like a solid plane rotating about the two pinned points) at high values of <code>ks</code>.</p>

        <p>The parameter <code>density</code> controls how much the cloth will fold on itself. With a low <code>density</code>, the cloth is very smooth. And has few ripples in its final position. With high <code>density</code>, the cloth folds onto itself more, creating smaller and more frequent ripples.</p>

        <div align="center">
			<table style="width=100%">
				<tr>
					<td align="middle">
						<img src="images/density1.png" width="500px" />
                        <figcaption>Density of 1 g/cm^2</figcaption>
					</td>
					<td align="middle">
						<img src="images/density150.png" width="500px" />
                        <figcaption>Density of 150 g/cm^2</figcaption>
					</td>
				</tr>
			</table>
		</div>

        <p>Increasing <code>damping</code> slows down the simulation and the apparent speed of the cloth but produces visually similar results by the end of the simulation. With the 4-pinned-corner cloth, <code>damping</code> changes the number of ripples in the cloth after it fully stretches itself: a higher <code>damping</code> value produces fewer ripples.</p>

        <div align="center">
			<table style="width=100%">
				<tr>
					<td align="middle">
						<img src="images/damping020.png" width="500px" />
                        <figcaption>Damping = 0.20%, after a few seconds</figcaption>
					</td>
					<td align="middle">
						<img src="images/damping080.png" width="500px" />
                        <figcaption>Damping = 0.80%, after about a minute</figcaption>
					</td>
				</tr>
			</table>
		</div>

        Below is the cloth with 4 pinned corners, shaded with the Blinn-Phong shader to better show how the cloth folds on itself.

        <div align="center">
			<table style="width=100%">
				<tr>
					<td align="middle">
						<img src="images/pinned4.png" width="500px" />
					</td>
				</tr>
			</table>
		</div>

        <h2 align="middle">Part 3: Handling collisions with other objects</h2>
				<p> In part 3, we implemented the <code>Sphere::collide</code> and <code>Plane::collide</code> method that allowed our mesh cloth to interact with spheres and planes.
					Generally, the collide method checks whether or not a point mass is inside the primitive. If it is, we adjust the point mass' position so that it lies just outside of
					the sphere/plane's surface. </p>

				<p> For sphere primitives, we calculated a vector, called <code>tangent</code> that extended from the given point mass' position to the sphere's origin (<code> point_mass.position - origin</code>)
				and found its Euclidean length by taking its <code>norm()</code>. We knew that the cloth intersects the primitive if this length was less than the sphere's radius. Thus, if the length <= radius,
			  then we would need to update the point mass' position to be slightly outside of the sphere's surface. To do this, we normalized the tangent vector and calculated a correction vector that would be added
			  to the point mass' <code>last_position</code> vector. To calculate the correction vector, we simply found the point of intersection between the ray and sphere's surface using the
				tangent vector, the radius, and the sphere's origin: <code>(tangent * radius) + origin</code>. Finally, we updated the point mass' position by scaling the correction vector by the constant of friction and
				adding this value to its last poisiton (<code>(1 - friction) * correction + last_position</code>). </p>

				<p> Below are a few images of the cloth with different ks values. </p>

				<div align="center">
						<table style="width=100%">
								<tr>
										<td align="middle">
												<img src="part3/500.png" width="300px" />
												<figcaption align="middle">ks = 500</figcaption>
											</td>
										<td align="middle">
												<img src="part3/5000.png" width="300px" />
												<figcaption align="middle">ks = 5000</figcaption>
											</td>
										<td align="middle">
												<img src="part3/50000.png" width="300px" />
												<figcaption align="middle">ks = 50000</figcaption>
											</td>
								</tr>
						</table>
		</div>

		<p> In order to do account for plane-cloth collisions, we did a similar thing as spheres, by calculating the direction (tangent) vector using <code> point_mass.position - point</code>, where <code>point</code>
		if a point on the surface plane. To check if there was a collision with the plane, we took the dot product between this vector and normal to the plane, and checked whether its product was negative. It if is, we know that the cloth intersect in some way.
	  From there, we created a vector <code>last</code> that determines the vector <code>pm.last_position - point</code>. This vector is used to check if the cloth's last position is on a different side of the plan than the cloth's initial position. If
	  it is, we know that the cloth intersected the plane, and thus we need to bump it back to the correct side of the plane using the correction vector and surface offset. Thus, if the dot product between
	  <code>last</code> and <code>normal</code> is not negative, we can add the surface offset to our tangent_point (calculated by <code>dot(direction vector, normal)</code>) and apply this to our correction vector. After calculating the correction vector based on
	  which side the cloth is on, we can finally update its position by scaling the correction by the friction coefficient (1 - friction) and adding this value to its <code>last_position</code> vector. </p>

		<p> Below are images of the cloth resting peacfully on the plane!</p>

		div align="center">
				<table style="width=100%">
						<tr>
								<td align="middle">
										<img src="part3/wire.png" width="300px" />
										<figcaption align="middle">ks = 500</figcaption>
									</td>
								<td align="middle">
										<img src="part3/texture.png" width="300px" />
										<figcaption align="middle">ks = 5000</figcaption>
									</td>
						</tr>
				</table>
</div>

        <h2 align="middle">Part 4: Handling self-collisions</h2>

        <div align="center">
			<table style="width=100%">
				<tr>
					<td align="middle">
						<img src="images/clothfold1.png" width="300px" />
                        <img src="images/clothfold2.png" width="500px" />
                        <img src="images/clothfold3.png" width="500px" />
					</td>
				</tr>
			</table>
            <figcaption>Images of the cloth falling on the ground and producing self-collisions.</figcaption>
		</div>

        <p>When varying the density, the magnitude of the self-collision forces increases. This leads to noisier edges in the cloth (greater displacement of the points) as well as greater frequency of folds. Also, at higher densities, the points far from the plane are affected less by the self-collision forces.</p>

        <div align="center">
			<table style="width=100%">
				<tr>
					<td align="middle">
						<img src="images/density_selfcollide-0001.png" width="900px" />
					</td>
				</tr>
			</table>
		</div>

        <p>A video comparing the rate various densities is below. The screenshot above was taken about 2 seconds in. The images from left to right have densities of 1, 15, and 150 g/cm^2. The three stitched videos are not synced perfectly in time but align closely.</p>

        <div align="center">
            <video controls width="900px">
                <source type="video/mp4"  src="images/density_selfcollide.mp4"/>
            </video>
        </div>

        <p>With larger values of <code>ks</code>, the cloth bends at more gradual angles. The folds are larger and more circular and make for more exaggerated motion.</p>

        <div align="center">
			<table style="width=100%">
				<tr>
					<td align="middle">
                        <img src="images/selfcollide-ks1.png" width="400px" />
                        <figcaption>Cloth folding, with ks=5000</figcaption>
                    </td>
                    <td align="middle">
                        <img src="images/selfcollide-ks2.png" width="400px" />
                        <figcaption>Cloth folding, with ks=500,000</figcaption>
					</td>
				</tr>
			</table>
		</div>

        <h2 align="middle">Part 5: Shaders</h2>

				<p> For this assignment, Natalie completed parts 1 and 3 while Ryan completed parts 2 and 4. We both worked on part 5. We were able to work well together, and were able to work on parts that were interesting to both of us, while still collaborating on the project together. </p>
